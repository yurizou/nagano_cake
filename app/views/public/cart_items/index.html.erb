<h1>ショッピングカート</h1>
<%= link_to "カートを空にする", cart_items_all_destroy_path, method: :delete %>

<table>
  <thead>
    <tr>
      <th>商品名</th>
      <th>単価（税込）</th>
      <th>数量</th>
      <th>小計</th>
      <th></th>
    </tr>

  </thead>
  <tbody>
    <% @total = 0 %>
    <% @cart_items.each do |cart_item| %>
    <tr>
      <th><%= image_tag cart_item.item.image, size: "200x200" %>
      <%= cart_item.item.name %>
      </th>
      <th><%= cart_item.item.with_tax_price %></th>
      <%= form_with model: cart_item, url: cart_item_path(cart_item.id), method: :patch do |f| %>
      <th>
        <%= f.select :amount, *[1..10], :value => cart_item.amount %>
        <%= f.submit "変更" %>
      </th>
      <% end %>
      <%#=小計の計算方法は？%>
      <th><%= cart_item.subtotal %></th>

      <th><%= link_to "削除する",cart_item_path(cart_item.id), method: :delete %></th>
    </tr>
    <% @total += cart_item.subtotal %>
    <% end %>
    
  </tbody>
  
</table>
   <div>
    <p>合計金額<%= @total %></p>

    <%= link_to "買い物を続ける", root_path %>
    <%= link_to "情報入力に進む", new_order_path %>
   </div>  